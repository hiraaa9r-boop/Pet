import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
// import 'package:firebase_auth/firebase_auth.dart';  // TEMPORANEAMENTE DISABILITATO

class LoginPage extends StatefulWidget { const LoginPage({super.key}); @override State<LoginPage> createState()=>_LoginPageState();}
class _LoginPageState extends State<LoginPage>{
  final _email=TextEditingController(); final _pwd=TextEditingController(); bool _loading=false;
  Future<void> _login() async {
    setState(()=>_loading=true);
    
    // MOCK LOGIN (SENZA FIREBASE) - Simula login di successo dopo 1 secondo
    await Future.delayed(const Duration(seconds: 1));
    
    // Verifica email/password base (per demo)
    if (_email.text.trim().isNotEmpty && _pwd.text.trim().length >= 6) {
      if(mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('✅ Login simulato con successo!'), backgroundColor: Colors.green)
        );
        context.go('/');
      }
    } else {
      if(mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('❌ Email o password non validi (min 6 caratteri)'), backgroundColor: Colors.red)
        );
      }
    }
    
    if(mounted) setState(()=>_loading=false);
    
    /* VERSIONE ORIGINALE CON FIREBASE (DA RIABILITARE DOPO)
    try{
      await FirebaseAuth.instance.signInWithEmailAndPassword(email:_email.text.trim(), password:_pwd.text.trim());
      if(mounted) context.go('/');
    } on FirebaseAuthException catch(e){
      if(mounted) ScaffoldMessenger.of(context).showSnackBar(SnackBar(content: Text(e.message??'Login fallito')));
    } finally { if(mounted) setState(()=>_loading=false); }
    */
  }
  @override Widget build(BuildContext context){
    return Scaffold(
      appBar: AppBar(title: const Text('Accedi')),
      body: Center(
        child: ConstrainedBox(
          constraints: const BoxConstraints(maxWidth: 420),
          child: Padding(
            padding: const EdgeInsets.all(24),
            child: Column(mainAxisSize: MainAxisSize.min, children:[
              Image.asset('assets/images/my_pet_care_logo.webp', height: 96),
              const SizedBox(height: 24),
              TextField(controller:_email, keyboardType: TextInputType.emailAddress, decoration: const InputDecoration(labelText:'Email')),
              const SizedBox(height: 12),
              TextField(controller:_pwd, obscureText:true, decoration: const InputDecoration(labelText:'Password')),
              const SizedBox(height: 16),
              SizedBox(width: double.infinity, child: FilledButton(onPressed:_loading?null:_login,
                child:_loading?const SizedBox(height:16,width:16,child:CircularProgressIndicator(strokeWidth:2)):const Text('Login'))),
              const SizedBox(height: 12),
              Wrap(spacing:16, children:[
                TextButton(onPressed:()=>context.push('/forgot'), child: const Text('Password dimenticata?')),
                TextButton(onPressed:()=>context.push('/register'), child: const Text('Registrati')),
              ]),
            ]),
          ),
        ),
      ),
    );
  }
}
